

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Computational Performance &mdash; GACODE 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="_static/contentui.css?v=4cf5b151" />
      <link rel="stylesheet" type="text/css" href="_static/css/custom.css?v=a0fb6060" />

  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=f2a433a1"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="_static/contentui.js?v=9ee86694"></script>
      <script>window.MathJax = {"tex": {"macros": {"qfilt": "{\\mathcal{Q}}", "exb": "{\\mathbf{E} \\hskip -1pt \\times \\hskip -1pt \\mathbf{B}}", "df": "{\\delta \\hskip -0.5pt f}", "vpar": "{{\\rm v}_\\parallel}", "vta": "{{\\rm v}_{ta}}", "bhat": "{\\textbf{b}}", "dv": "{d^{\\hskip 1pt 3} \\hskip -1pt {\\rm v}}", "jp": "{{\\cal J}_\\psi}", "B": "{\\mathbf{B}}", "bunit": "{B_\\mathrm{unit}}", "betae": "{\\beta_{e,{\\rm unit}}}", "dphi": "{\\delta \\hskip -1pt \\phi}", "dap": "{\\delta \\hskip -1pt A_\\parallel}", "dbp": "{\\delta \\hskip -1pt B_\\parallel}", "dphif": "{\\delta \\hskip -0.5pt \\widetilde{\\phi}}", "dapf": "{\\delta \\hskip -0.5pt \\widetilde{A}_\\parallel}", "dbpf": "{\\delta \\hskip -0.5pt \\widetilde{B}_\\parallel}", "na": "{N_\\alpha}", "nr": "{N_r}", "nx": "{N_\\xi}", "nux": "{N_u}", "nt": "{N_\\theta}", "ux": "{u}", "uxa": "{{\\ux}_a}", "uxb": "{{\\ux}_b}", "kpv": "{{\\bf k}_\\perp}", "md": "{m_\\mathrm{D}}", "Hf": "{\\widetilde{H}_a}", "Hk": "{H_{a,\\kpv}}", "Hkb": "{H_{b,\\kpv}}", "Hfb": "{\\widetilde{H}_b}", "pf": "{\\widetilde{\\Psi}_a}", "rhos": "{\\rho_s}", "hf": "{\\widetilde{h}_a}", "kperp": "{{\\mathbf k}_\\perp}", "qgb": "{Q_\\mathrm{GB}}", "kx": "{k_x^0}", "fwid": "{3.2in}", "nlc": "{\\texttt{nl03}\\xspace}", "rhof": "{\\rho_\\mathrm{f}}"}}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="CGYRO Workshop 2022" href="workshop.html" />
    <link rel="prev" title="input.gacode" href="input_gacode.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            GACODE
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="README.html">Using GACODE</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup.html">Prebuilt Environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="build.html">Build on your laptop</a></li>
<li class="toctree-l1"><a class="reference internal" href="zreferences.html">References</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Codes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="neo.html">NEO</a></li>
<li class="toctree-l1"><a class="reference internal" href="tgyro.html">TGYRO</a></li>
<li class="toctree-l1"><a class="reference internal" href="cgyro.html">CGYRO</a></li>
<li class="toctree-l1"><a class="reference internal" href="gyro.html">GYRO</a></li>
<li class="toctree-l1"><a class="reference internal" href="tglf.html">TGLF</a></li>
<li class="toctree-l1"><a class="reference internal" href="prgen.html">profiles_gen</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Physics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="geometry.html">Flux-Surface Geometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="rotation.html">Rotation Theory</a></li>
<li class="toctree-l1"><a class="reference internal" href="input_gacode.html">input.gacode</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Misc</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Computational Performance</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#computational-approach">Computational Approach</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#library-overview">Library overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#gyrokinetic-framework">Gyrokinetic framework</a></li>
<li class="toctree-l3"><a class="reference internal" href="#time-advance">Time advance</a></li>
<li class="toctree-l3"><a class="reference internal" href="#fft-based-evaluation-of-the-nonlinearity">FFT-based evaluation of the nonlinearity</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="workshop.html">CGYRO Workshop 2022</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">GACODE</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Computational Performance</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/performance.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="computational-performance">
<h1>Computational Performance<a class="headerlink" href="#computational-performance" title="Link to this heading"></a></h1>
<p><strong>Updated April 2025</strong></p>
<p>Recent information about the computational approach and scaling performance of CGYRO <span id="id1">[<a class="reference internal" href="zreferences.html#id193" title="J. Candy, E.A. Belli, and R.V. Bravenec. A high-accuracy Eulerian gyrokinetic solver for collisional plasmas. J. Comput. Phys., 324:73, 2016. doi:doi.org/10.1016/j.jcp.2016.07.039.">CBB16</a>, <a class="reference internal" href="zreferences.html#id195" title="J. Candy, I. Sfiligoi, E. Belli, K. Hallatschek, C. Holland, N. Howard, and E.D`Azevedo. Multiscale-optimized plasma turbulence simulation on petascale architechtures. Computers &amp; Fluids, 188:125, 2019. doi:doi.org/10.1016/j.compfluid.2019.04.016.">CSB+19</a>, <a class="reference internal" href="zreferences.html#id975" title="I. Sfiligoi, E. Belli, J. Candy, and R.D. Budiardja. Optimization and portability of a fusion OpenACC-based HPC code from NVIDIA to AMD GPUs. In PEARC '23: Practice and Experience in Advanced Research Computing, Association for Computing Machinery, pages 246-250, 2023.">SBCB23</a>, <a class="reference internal" href="zreferences.html#id974" title="I. Sfiligoi, E. Belli, J. Candy, and F. Wurthwein. Comparing single-node and multi-node performance of an important fusion HPC code benchmark. In PEARC '22: Practice and Experience in Advanced Research Computing, Association for Computing Machinery, Article No. 10, p.1-4, 2022.">SBCW22</a>]</span> is documented here.</p>
<section id="computational-approach">
<h2>Computational Approach<a class="headerlink" href="#computational-approach" title="Link to this heading"></a></h2>
<section id="library-overview">
<h3>Library overview<a class="headerlink" href="#library-overview" title="Link to this heading"></a></h3>
<p>CGYRO is written in Fortran, with GPU accelerator optimizations implemented using OpenACC or OpenMP offloading, and communication with GPU-aware MPI. Heavy use of cuFFT/rocFFT is made for the nonlinear term. Analysis tools are based on Python scripts. Exceptional GPU scaling performance on OLCF Summit has been demonstrated through previous ALCC and INCITE Awards over the years 2019-2024. On Summit, the following modules were used: <code class="docutils literal notranslate"><span class="pre">pgi,</span> <span class="pre">spectrum-mpi,</span> <span class="pre">fftw,</span> <span class="pre">netlib-lapack,</span> <span class="pre">essl,</span> <span class="pre">cuda,</span> <span class="pre">python.</span></code>  In early 2023, CGYRO was ported to OLCF Frontier <span id="id2">[<a class="reference internal" href="zreferences.html#id975" title="I. Sfiligoi, E. Belli, J. Candy, and R.D. Budiardja. Optimization and portability of a fusion OpenACC-based HPC code from NVIDIA to AMD GPUs. In PEARC '23: Practice and Experience in Advanced Research Computing, Association for Computing Machinery, pages 246-250, 2023.">SBCB23</a>]</span>, and capability-scale simulations using more than 20% of the system were carried out in a 2023-2024 INCITE project. Over 87% of CGYRO usage for our 2024 INCITE was capability-scale (over 90% for 2023 INCITE), using at least 2048 nodes (8192 MI250X accelerators) on Frontier. On Frontier, CGYRO uses the HPE Cray Compiling Environment (CCE) Fortran compiler <code class="docutils literal notranslate"><span class="pre">(PrgEnv-cray,</span> <span class="pre">cray-mpich)</span></code>, <code class="docutils literal notranslate"><span class="pre">craype-accel-amd-gfx90a</span></code> (for GPU-aware Cray mpich), <code class="docutils literal notranslate"><span class="pre">cray-python,</span> <span class="pre">rocm</span></code> and AMD <code class="docutils literal notranslate"><span class="pre">hipfort</span></code> providing Fortran interfaces for calling HIP libraries <code class="docutils literal notranslate"><span class="pre">hipFFT/rocFFT</span></code>.</p>
</section>
<section id="gyrokinetic-framework">
<h3>Gyrokinetic framework<a class="headerlink" href="#gyrokinetic-framework" title="Link to this heading"></a></h3>
<p>CGYRO solves the nonlinear, electromagnetic gyrokinetic equations  <span id="id3">[<a class="reference internal" href="zreferences.html#id1039" title="H. Sugama and W. Horton. Nonlinear electromagnetic gyrokinetic equation for plasmas with large mean flows. Phys. Plasmas, 5:2560, 1998. doi:doi.org/10.1063/1.872941.">SH98</a>]</span> for 5D particle distributions <span class="math notranslate nohighlight">\(\Hf(k_x,k_y,\theta;\xi,{\rm v})\)</span>, where the subscript <span class="math notranslate nohighlight">\(a\)</span> is the species index, and tildes indicate a Fourier-space quantity. The <em>spatial coordinates</em> are</p>
<div class="math notranslate nohighlight" id="equation-eq-coord">
<span class="eqno">(2)<a class="headerlink" href="#equation-eq-coord" title="Link to this equation"></a></span>\[\begin{split}\begin{align}
k_x    &amp; \rightarrow  \text{radial wavenumber}   \; ,  \\
k_y    &amp; \rightarrow  \text{binormal wavenumber} \; ,  \\
\theta &amp; \rightarrow  \text{field-line coordinate}
\end{align}\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(k_\perp^2 = k_x^2 + k_y^2\)</span>, and the <em>velocity-space</em> coordinates are</p>
<div class="math notranslate nohighlight">
\[\begin{split}\xi = \vpar/{\rm v}  &amp; \rightarrow  \text{pitch angle cosine} \in [-1,1] \; , \\
{\rm v}              &amp; \rightarrow  \text{speed} \in [0,\infty] \; .\end{split}\]</div>
<p>The use of <em>twisted fieldline coordinates</em> gives radial wavenumbers <span class="math notranslate nohighlight">\(k_x\)</span> that depend on <span class="math notranslate nohighlight">\(\theta\)</span> and <span class="math notranslate nohighlight">\(k_y\)</span> <span id="id4">[<a class="reference internal" href="zreferences.html#id193" title="J. Candy, E.A. Belli, and R.V. Bravenec. A high-accuracy Eulerian gyrokinetic solver for collisional plasmas. J. Comput. Phys., 324:73, 2016. doi:doi.org/10.1016/j.jcp.2016.07.039.">CBB16</a>]</span>. For this reason, we define a simple radial wavenumber <span class="math notranslate nohighlight">\(\kx\)</span> (the value of <span class="math notranslate nohighlight">\(k_x\)</span> at <span class="math notranslate nohighlight">\(\theta=0\)</span>). The <span class="math notranslate nohighlight">\((k_x,k_y)\)</span> spectral representation facilitates the arbitrary wavelength formulation by diagonalizing the gyroradius operator. The GK equations are written in terms of an EM <em>field potential</em> <span class="math notranslate nohighlight">\(\pf\)</span>,</p>
<div class="math notranslate nohighlight" id="equation-eq-fpto">
<span class="eqno">(3)<a class="headerlink" href="#equation-eq-fpto" title="Link to this equation"></a></span>\[ \pf = J_{0}(k_\perp \rho_a) \left( \dphif - \frac{\vpar}{c} \dapf \right) + \frac{m_a {\rm v}_{\perp}^2}{z_{a} e B} \frac{J_{1}(k_\perp \rho_a)}{k_\perp \rho_a} \dbpf \; ,\]</div>
<p>where <span class="math notranslate nohighlight">\(m_a, z_a\)</span> and <span class="math notranslate nohighlight">\(\rho_a\)</span> are the species mass, charge and gyroradius.  Above, <span class="math notranslate nohighlight">\((\dphif,\dapf,\dbpf)\)</span> are the electrostatic and transverse/compressional EM potentials, respectively, computed from the gyrokinetic Maxwell equations <span id="id5">[<a class="reference internal" href="zreferences.html#id1039" title="H. Sugama and W. Horton. Nonlinear electromagnetic gyrokinetic equation for plasmas with large mean flows. Phys. Plasmas, 5:2560, 1998. doi:doi.org/10.1063/1.872941.">SH98</a>]</span>.  The Bessel functions <span class="math notranslate nohighlight">\(J_{0}\)</span> and <span class="math notranslate nohighlight">\(J_{1}\)</span> arise from gyroaveraging. In terms of <span class="math notranslate nohighlight">\(\pf\)</span>, the GK equation for species <span class="math notranslate nohighlight">\(a\)</span> can be written as</p>
<div class="math notranslate nohighlight" id="equation-eq-gk">
<span class="eqno">(4)<a class="headerlink" href="#equation-eq-gk" title="Link to this equation"></a></span>\[\frac{\partial \hf}{\partial \tau} + A(\Hf,\pf) + B(\Hf,\pf) = 0 \; ,\]</div>
<p>with <span class="math notranslate nohighlight">\(\tau \doteq (c_s/a) t\)</span> the normalized time, <span class="math notranslate nohighlight">\(a\)</span> the separatrix minor radius, <span class="math notranslate nohighlight">\(c_s=\sqrt{T_e/m_D}\)</span> the deuteron (mass <span class="math notranslate nohighlight">\(m_D\)</span>) sound speed, and <span class="math notranslate nohighlight">\(T_e\)</span> the electron temperature. <span class="math notranslate nohighlight">\(A(\Hf,\pf)\)</span> and <span class="math notranslate nohighlight">\(B(\Hf,\pf)\)</span> represent the <strong>collisionless</strong> and <strong>collisional</strong> terms, respectively. In Eq. <a class="reference internal" href="#equation-eq-gk">(4)</a>, <span class="math notranslate nohighlight">\(\Hf\)</span> is the <em>nonadiabatic distribution</em> whereas <span class="math notranslate nohighlight">\(\hf\)</span> is a <em>modified distribution</em> suitable for numerical time-integration.  They are related through the field potential by <span class="math notranslate nohighlight">\(\hf = \Hf - (z_a T_e)/T_a \pf\)</span>.</p>
<div class="math notranslate nohighlight" id="equation-eq-maxwell">
<span class="eqno">(5)<a class="headerlink" href="#equation-eq-maxwell" title="Link to this equation"></a></span>\[\begin{split}\left( k_\perp^2 \lambda_D^2 n_e + \sum_a \frac{z_a^2 T_e}{T_a} n_a \right) \dphif &amp; = \sum_a z_a e \int \hskip -3pt \dv f_{0a} J_0(k_\perp \rho_a) \Hf \; , \\
- \frac{2 n_e}{\betae} k_\perp^2 \rho_s^2 \dapf &amp; = \sum_a z_a e \int \hskip -3pt \dv \frac{\vpar}{c_s} f_{0a} J_0(k_\perp \rho_a) \Hf \; \\
  -\frac{2 n_e}{\betae} \frac{B}{B_{\rm unit}} \dbpf &amp; = \sum_a \int \hskip -3pt \dv \frac{m_a {\rm v}_{\perp}^2}{T_e} f_{0a} \frac{J_1(k_\perp \rho_a)}{k_\perp \rho_a} \Hf \; .\end{split}\]</div>
<p>Here <span class="math notranslate nohighlight">\(\lambda_D = \sqrt{T_e/(4 \pi n_e e^2)}\)</span> is the Debye length and <span class="math notranslate nohighlight">\(\betae = 8 \pi n_e T_e/\bunit^2\)</span> is the effective electron beta, where <span class="math notranslate nohighlight">\(\bunit\)</span> is the effective magnetic field <span id="id6">[<a class="reference internal" href="zreferences.html#id189" title="J. Candy and E. Belli. GYRO Technical Guide. General Atomics Technical Report, 2010.">CB10</a>]</span>.</p>
</section>
<section id="time-advance">
<h3>Time advance<a class="headerlink" href="#time-advance" title="Link to this heading"></a></h3>
<p>Operator splitting is used to separate the evolution of <span class="math notranslate nohighlight">\(A(\Hf,\pf)\)</span> and <span class="math notranslate nohighlight">\(B(\Hf,\pf)\)</span>. This allows the nonlinear, collisionless dynamics <span class="math notranslate nohighlight">\((A)\)</span> to be treated explicitly, while the collisional dynamics <span class="math notranslate nohighlight">\((B)\)</span> is advanced implicitly.  First, the <strong>collisionless step</strong> operates primarily on the spatial dimensions and is distributed in the velocity dimensions, requiring solution of</p>
<div class="math notranslate nohighlight" id="equation-eq-gk-a">
<span class="eqno">(6)<a class="headerlink" href="#equation-eq-gk-a" title="Link to this equation"></a></span>\[\frac{\partial \hf}{\partial \tau} + A(\Hf,\pf) = 0 \; .\]</div>
<p>We write the collisionless term as:</p>
<div class="math notranslate nohighlight" id="equation-eq-nl">
<span class="eqno">(7)<a class="headerlink" href="#equation-eq-nl" title="Link to this equation"></a></span>\[\begin{split}\begin{multline}
A(\Hf,\pf) = -i \left( \Omega_{\rm parallel} + \Omega_{\rm drift} \right) \Hf
- i \Omega_* \pf -i \Omega_s X \hf \\
  \qquad - \frac{c}{B} \frac{a}{c_s} \sum_{\kpv^\prime + \kpv^{\prime \prime} = \kpv}
    \left( \bhat \cdot \kpv^\prime \times \kpv^{\prime \prime} \right)
    \pf(\kpv^\prime) \hf(\kpv^{\prime \prime}) \; .
\end{multline}\end{split}\]</div>
<p>The linear terms in <span class="math notranslate nohighlight">\(A\)</span> include the parallel streaming along the field line <span class="math notranslate nohighlight">\(\Omega_{\rm parallel}\)</span>, drift motion perpendicular to the field line <span class="math notranslate nohighlight">\(\Omega_{\rm drift}\)</span>, <em>instability drive</em> from equilibrium density and temperature gradients <span class="math notranslate nohighlight">\(\Omega_*\)</span>, and <span class="math notranslate nohighlight">\(\exb\)</span> shear (see Ref. <span id="id7">[<a class="reference internal" href="zreferences.html#id193" title="J. Candy, E.A. Belli, and R.V. Bravenec. A high-accuracy Eulerian gyrokinetic solver for collisional plasmas. J. Comput. Phys., 324:73, 2016. doi:doi.org/10.1016/j.jcp.2016.07.039.">CBB16</a>]</span>). These linear terms define the <em>streaming kernel</em>, hereafter referred to as <code class="docutils literal notranslate"><span class="pre">str</span></code>. The last term in Eq. <a class="reference internal" href="#equation-eq-nl">(7)</a> is a convolution (Poisson bracket in real space).  This defines the <em>nonlinear kernel</em> and is hereafter referred to as <code class="docutils literal notranslate"><span class="pre">nl</span></code>. Note that <strong>global capability</strong> (profile-curvature, or radial profile variation of the plasma density, temperature, and rotation of the equilibrium state) is enabled using a novel <em>wavenumber advection</em> scheme <span id="id8">[<a class="reference internal" href="zreferences.html#id194" title="J. Candy and E.A. Belli. Spectral treatment of gyrokinetic shear flow. J. Comput. Phys., 356:448, 2018. doi:doi.org/10.1016/j.jcp.2017.12.020.">CB18</a>, <a class="reference internal" href="zreferences.html#id196" title="J. Candy, E.A. Belli, and G. Staebler. Spectral treatment of gyrokinetic profile curvature. Plasma Phys. Control. Fusion, 62:042001, 2020. doi:doi.org/10.1088/1361-6587/ab759c.">CBS20</a>]</span>.  Explicit coupling with the Maxwell equations is also required to advance <span class="math notranslate nohighlight">\(\pf\)</span> in time. This operation defines the <em>field solve</em> kernel, hereafter referred to as <code class="docutils literal notranslate"><span class="pre">field</span></code>.  To advance Eq. <a class="reference internal" href="#equation-eq-gk-a">(6)</a>, RK4 or adaptive RK5(4)/RK7(6) methods are used.</p>
<p>The <strong>collisional step</strong> acts primarily on velocity dimensions and is distributed in the spatial dimensions:</p>
<div class="math notranslate nohighlight" id="equation-eq-cstep">
<span class="eqno">(8)<a class="headerlink" href="#equation-eq-cstep" title="Link to this equation"></a></span>\[\frac{\partial \hf}{\partial \tau} + B(\Hf,\pf) = 0 \quad \text{where} \quad
B(\Hf,\pf) = -i \Omega_{\xi} \Hf - \frac{a}{c_s} \sum_b C_{ab}^{L}(\Hf,\Hfb) \; .\]</div>
<p>Here <span class="math notranslate nohighlight">\(-i \Omega_{\xi}\)</span> describes linear trapped particle motion, and <span class="math notranslate nohighlight">\(C_{ab}^{L}\)</span> is the Sugama cross-species collision operator <span id="id9">[<a class="reference internal" href="zreferences.html#id1042" title="H. Sugama, T.-H. Watanabe, and M. Nunami. Linearized model collision operators for multiple ion species plasmas and gyrokinetic entropy balance equations. Phys. Plasmas, 16:112503, 2009. doi:doi.org/10.1063/1.3257907.">SWN09</a>]</span>, which describes pitch-angle and energy diffusion. This is one of the most sophisticated collision operators available in numerical gyrokinetics.  A Legendre pseudospectral discretization in <span class="math notranslate nohighlight">\(\xi\)</span> is combined with a Steen pseudospectral discretization in <span class="math notranslate nohighlight">\({\rm v}\)</span>. Using a weak form of the discrete collision matrix, we construct a self-adjoint pseudospectral representation.  An implicit time-advance is necessary for stability without severe accuracy loss. Using a generalization of the Crank-Nicolson method, Eq. <a class="reference internal" href="#equation-eq-cstep">(8)</a> is advanced with a single matrix-vector multiply (matrix rank <span class="math notranslate nohighlight">\(N_\xi N_v N_a\)</span>).  The matrix is large and well-suited to execution on GPUs. The <em>collision kernel</em> is hereafter referred to as <code class="docutils literal notranslate"><span class="pre">coll</span></code>.</p>
</section>
<section id="fft-based-evaluation-of-the-nonlinearity">
<h3>FFT-based evaluation of the nonlinearity<a class="headerlink" href="#fft-based-evaluation-of-the-nonlinearity" title="Link to this heading"></a></h3>
<p>Evaulation of the quadratic nonlinearity in Eq. <a class="reference internal" href="#equation-eq-nl">(7)</a> is done in a standard way using a 2D dealiased FFT <span id="id10">[<a class="reference internal" href="zreferences.html#id805" title="S.A. Orszag. On the elimination of aliasing in finite-difference schemes by filtering high-wavenumber components. J. Atmos. Sci., 28:1074, 1971. doi:doi.org/10.1175/1520-0469(1971)028&lt;1074:OTEOAI&gt;2.0.CO;2.">Ors71</a>]</span>.  To prevent <em>aliasing</em>, we zero-pad the spectral representation by a factor of <span class="math notranslate nohighlight">\(3/2\)</span>. The convolution conserves important flow invariants and eliminates a class of nonlinear instabilities from the numerical solution. To perform the forward and inverse FFTs, we use <code class="docutils literal notranslate"><span class="pre">FFTW</span></code> <span id="id11">[<a class="reference internal" href="zreferences.html#id371" title="M. Frigo and S.G. Johnson. The design and implementation of FFTW3. Proc. IEEE, 93 (2):216, 2005. doi:doi.org/10.1109/JPROC.2004.840301.">FJ05</a>]</span> by default with options for cuFFT/rocFFT (GPU) on Summit/Frontier and Intel MKL on supported platforms.  First, we perform a series of four 2D complex-to-real <code class="docutils literal notranslate"><span class="pre">(c2r)</span></code> transforms:</p>
<div class="math notranslate nohighlight">
\[\begin{split}(i k_x) \pf &amp; \underset{\mathtt{c2r}}{\longrightarrow} \frac{\partial \Psi_a}{\partial x} \, , \\
(i k_x) \hf &amp; \underset{\mathtt{c2r}}{\longrightarrow} \frac{\partial h_a}{\partial x} \, , \\
(i k_y) \pf &amp; \underset{\mathtt{c2r}}{\longrightarrow} \frac{\partial \Psi_a}{\partial y} \, , \\
(i k_y) \hf &amp; \underset{\mathtt{c2r}}{\longrightarrow} \frac{\partial h_a}{\partial y} \; ,\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span> are real-space meshpoints, such that all arrays are extended and
zero-padded by a factor of <span class="math notranslate nohighlight">\(3/2\)</span> (quantities without tildes are in real space).  The real-space
products are then taken, followed by the inverse transform of the entire nonlinearity via
a single 2D real-to-complex <code class="docutils literal notranslate"><span class="pre">r2c</span></code> transform</p>
<div class="math notranslate nohighlight">
\[- \frac{\partial \Psi_a}{\partial x} \frac{\partial h_a}{\partial y} +
 \frac{\partial h_a}{\partial x} \frac{\partial \Psi_a}{\partial y}
 \underset{\mathtt{r2c}}{\longrightarrow}  \left( \bhat \cdot
 \kpv^\prime \times \kpv^{\prime \prime} \right) \pf(\kpv^\prime)
 \hf(\kpv^{\prime \prime}) \; .\]</div>
<table class="docutils align-center" id="tab-kernels">
<caption><span class="caption-number">Table 31 </span><span class="caption-text">Summary of data properties of kernels. <code class="docutils literal notranslate"><span class="pre">str</span></code> refers to parallel streaming, <code class="docutils literal notranslate"><span class="pre">field</span></code> refers to the solution of the three Maxwell equations, <code class="docutils literal notranslate"><span class="pre">coll</span></code> refers to the implicit collision step, and <code class="docutils literal notranslate"><span class="pre">nl</span></code> refers to the nonlinear bracket (convolution).  In each case, the communication cost associated with each kernel is denoted by the <code class="docutils literal notranslate"><span class="pre">comm</span></code> suffix.</span><a class="headerlink" href="#tab-kernels" title="Link to this table"></a></caption>
<colgroup>
<col style="width: 25.0%" />
<col style="width: 50.0%" />
<col style="width: 25.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Kernel</p></th>
<th class="head"><p>Data dependence</p></th>
<th class="head"><p>Dominant operation</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">str</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\({\kx,\theta},[k_y]_2,[\xi,{\rm v},a]_1\)</span></p></td>
<td><p>loop</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">field</span></code></p></td>
<td><p>Same as <code class="docutils literal notranslate"><span class="pre">str</span></code></p></td>
<td><p>loop</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">coll</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\([\kx,\theta]_1,[k_y]_2,\xi,{\rm v},a\)</span></p></td>
<td><p>mat-vec multiply</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">nl</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\({\kx,k_y},[\theta,[\xi,{\rm v},a]_1]_2\)</span></p></td>
<td><p>FFT</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">str_comm</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\({\kx,\theta},[k_y]_2,\underline{[\xi,{\rm v},a]_1}\)</span></p></td>
<td><p>MPI_ALLREDUCE</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">field_comm</span></code></p></td>
<td><p>Same as <code class="docutils literal notranslate"><span class="pre">str_comm</span></code></p></td>
<td><p>MPI_ALLREDUCE</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">coll_comm</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(\kx,\theta,[k_y]_2,[\xi,{\rm v},a]_1\)</span><span class="math notranslate nohighlight">\(\leftrightarrow [\kx,\theta]_1,[k_y]_2,\xi,{\rm v},a\)</span></p></td>
<td><p>MPI_ALLTOALL</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">nl_comm</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(\kx,\theta,[k_y]_2,[\xi,{\rm v},a]_1\)</span><span class="math notranslate nohighlight">\(\leftrightarrow \kx,k_y,[\theta,[\xi,{\rm v},a]_1]_2\)</span></p></td>
<td><p>MPI_ALLTOALL</p></td>
</tr>
</tbody>
</table>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="input_gacode.html" class="btn btn-neutral float-left" title="input.gacode" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="workshop.html" class="btn btn-neutral float-right" title="CGYRO Workshop 2022" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2000-2025.
      <span class="lastupdated">Last updated on Apr 24, 2025.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>