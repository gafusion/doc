<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Build from sources &mdash; GACODE</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="_static/contentui.css" />

  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=5929fcd5"></script>
        <script src="_static/doctools.js?v=9a2dae69"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="_static/contentui.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="References" href="zreferences.html" />
    <link rel="prev" title="Environment setup" href="setup.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            GACODE
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Software</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="license.html">GACODE License</a></li>
<li class="toctree-l1"><a class="reference internal" href="download.html">Download and user agreement</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup.html">Environment setup</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Build from sources</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="#source-code">Source code</a></li>
<li class="toctree-l2"><a class="reference internal" href="#concept-of-platform-files">Concept of platform files</a></li>
<li class="toctree-l2"><a class="reference internal" href="#environment-variables">Environment variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="#openblas">OpenBLAS</a></li>
<li class="toctree-l2"><a class="reference internal" href="#building">Building</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="zreferences.html">References</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Codes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="neo.html">NEO</a></li>
<li class="toctree-l1"><a class="reference internal" href="tgyro.html">TGYRO</a></li>
<li class="toctree-l1"><a class="reference internal" href="cgyro.html">CGYRO</a></li>
<li class="toctree-l1"><a class="reference internal" href="gyro.html">GYRO</a></li>
<li class="toctree-l1"><a class="reference internal" href="tglf.html">TGLF</a></li>
<li class="toctree-l1"><a class="reference internal" href="prgen.html">profiles_gen</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Physics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="geometry.html">FLUX-SURFACE GEOMETRY</a></li>
<li class="toctree-l1"><a class="reference internal" href="rotation.html">PLASMA ROTATION THEORY</a></li>
<li class="toctree-l1"><a class="reference internal" href="input_gacode.html">input.gacode</a></li>
<li class="toctree-l1"><a class="reference internal" href="misc.html">Miscellaneous</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">GACODE</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Build from sources</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/build.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="build-from-sources">
<h1>Build from sources<a class="headerlink" href="#build-from-sources" title="Link to this heading"></a></h1>
<section id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Link to this heading"></a></h2>
<p>You will need suitable python and fortran environments. There is detailed help for <a class="reference internal" href="build/pre_osx.html"><span class="doc">OSX users</span></a> and <a class="reference internal" href="build/pre_linux.html"><span class="doc">Linux users</span></a>.</p>
</section>
<section id="source-code">
<h2>Source code<a class="headerlink" href="#source-code" title="Link to this heading"></a></h2>
<p>You should clone the gacode repository from GitHub. This was you can keep you installation up to date:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ git clone git@github.com:gafusion/gacode.git
</pre></div>
</div>
</section>
<section id="concept-of-platform-files">
<h2>Concept of platform files<a class="headerlink" href="#concept-of-platform-files" title="Link to this heading"></a></h2>
<p>In order to compile the full GACODE package on a new machine, <strong>platform files</strong> must be created. You can use existing ones or create your own.  After cloning the repository, you can query the existing platforms using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ./gacode/shared/bin/gacode_platforms
</pre></div>
</div>
<p>To create new platform files (say, for a new platform MINE) then copy/edit the following files:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$GACODE_ROOT/platform/build/make.inc.MINE
$GACODE_ROOT/platform/exec/exec.MINE
$GACODE_ROOT/platform/env/env.MINE (if needed)
</pre></div>
</div>
<p>Numerous templates for each of these files can be found in the specific folders, and most often there will be an existing machine files that is almost exactly what you need</p>
</section>
<section id="environment-variables">
<h2>Environment variables<a class="headerlink" href="#environment-variables" title="Link to this heading"></a></h2>
<p>To use your new platform files, enter the following lines in your shell RC file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>export GACODE_PLATFORM=MINE
export GACODE_ROOT=$HOME/gacode
. $GACODE_ROOT/shared/bin/gacode_setup
. $GACODE_ROOT/platform/env/env.MINE (if needed)
</pre></div>
</div>
</section>
<section id="openblas">
<h2>OpenBLAS<a class="headerlink" href="#openblas" title="Link to this heading"></a></h2>
<p>When building with gfortran, we recommend using <a class="reference external" href="https://github.com/xianyi/OpenBLAS.git">OpenBLAS</a>. It is important to build with <strong>single-threaded</strong> settings. In the Makefile.rule file in the top-level OpenBLAS directory, set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">BINARY</span><span class="o">=</span><span class="mi">64</span>
<span class="n">USE_THREAD</span><span class="o">=</span><span class="mi">0</span>
<span class="n">USE_LOCKING</span><span class="o">=</span><span class="mi">1</span>
<span class="n">NO_SHARED</span><span class="o">=</span><span class="mi">1</span>
<span class="n">NO_CBLAS</span><span class="o">=</span><span class="mi">1</span>
<span class="n">NO_LAPACKE</span><span class="o">=</span><span class="mi">1</span>
</pre></div>
</div>
<p>You can find an example of linking to OpenBLAS in the <a class="reference external" href="https://github.com/gafusion/gacode/blob/master/platform/build/make.inc.MINT">MINT platform file</a>. To test the thread safety, you can use the test program in shared/hybridtest:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cd gacode/shared/hybridtest
$ make clean ; make
$ ./test
</pre></div>
</div>
</section>
<section id="building">
<h2>Building<a class="headerlink" href="#building" title="Link to this heading"></a></h2>
<p>To build the entire GACODE project, type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cd $GACODE_ROOT ; make
</pre></div>
</div>
<p>To test that the build is successful, you can run regression tests:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ neo -r
$ tglf -r
$ cgyro -r -n 4 -nomp 2
</pre></div>
</div>
<p>This last command run the complete CGYRO regression test suite using 4 MPI tasks and 2 OpenMP threads (8 total threads).</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="setup.html" class="btn btn-neutral float-left" title="Environment setup" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="zreferences.html" class="btn btn-neutral float-right" title="References" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2010-2024.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>